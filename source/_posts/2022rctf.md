---
title:  2022RCTF
categories: ctf
toc: true
date: 2022/12/14
tags: 比赛
---
坐牢坐牢坐牢orz

# ez_alient

alien.bmp文件尾部存在压缩包解压密码

解压后文件查看文件头发现为可执行文件，运行后发现为pygame即pyexe

使用pyinstxtractor.py解包可得pyc文件

```she
python pyinstxtractor.py alien_invasion.exe
```



![image-20221214221459545](https://picture-1312836458.cos.ap-beijing.myqcloud.com/img/image-20221214221459545.png)

同路径下会出现的[xxx.exe]_extracted的文件夹里面就包含了主程序main，但不带任何后缀，我们要反编译的就是这个文件，其他的都是依赖库，如PYZ-extracted文件夹里的都是库文件（用于import）。

![image-20221214221835997](https://picture-1312836458.cos.ap-beijing.myqcloud.com/img/image-20221214221835997.png)

至于为什么该文件不是.pyc文件，应该是pyinstxtractor的一点不足，转换出来的主程序格式不对，因此还需要对其进行手动修复。
这里了解下不同版本python下pyc文件头的结构（[链接](https://blog.csdn.net/Zheng__Huang/article/details/112380221)）：

Python3.3以下的版本中，只有**Magic Number**和**四位时间戳**（共8字节）
Python3.3到Python3.7（不包含3.7）版本中，只有**Magic Numbe**r和**八位时间戳** + **大小信息**（共12字节）
Python3.7及以上版本的编译后二进制文件中，头部除了**四字节Magic Number**，还有**四个字节的空位**和**八个字节的时间戳** + **大小信息**（共16字节），后者（指后12字节）对文件反编译没有影响，全部填充0即可

**python Magic Number对照表**

```she
enum PycMagic {    
MAGIC_1_0 = 0x00999902,    
MAGIC_1_1 = 0x00999903, /* Also covers 1.2 */    
MAGIC_1_3 = 0x0A0D2E89,    
MAGIC_1_4 = 0x0A0D1704,    
MAGIC_1_5 = 0x0A0D4E99,    
MAGIC_1_6 = 0x0A0DC4FC,     
MAGIC_2_0 = 0x0A0DC687,    
MAGIC_2_1 = 0x0A0DEB2A,    
MAGIC_2_2 = 0x0A0DED2D,    
MAGIC_2_3 = 0x0A0DF23B,    
MAGIC_2_4 = 0x0A0DF26D,    
MAGIC_2_5 = 0x0A0DF2B3,    
MAGIC_2_6 = 0x0A0DF2D1,    
MAGIC_2_7 = 0x0A0DF303,     
MAGIC_3_0 = 0x0A0D0C3A,    
MAGIC_3_1 = 0x0A0D0C4E,    
MAGIC_3_2 = 0x0A0D0C6C,    
MAGIC_3_3 = 0x0A0D0C9E,    
MAGIC_3_4 = 0x0A0D0CEE,    
MAGIC_3_5 = 0x0A0D0D16,    
MAGIC_3_5_3 = 0x0A0D0D17,    
MAGIC_3_6 = 0x0A0D0D33,    
MAGIC_3_7 = 0x0A0D0D42,    
MAGIC_3_8 = 0x0A0D0D55,    
MAGIC_3_9 = 0x0A0D0D61, };
```

![image-20221228171112963](https://picture-1312836458.cos.ap-beijing.myqcloud.com/img/image-20221228171112963.png)

根据其他解包好的pyc文件头且这里是py38，第一行添加16个字节去修主函数即可成功逆向

这里发现其他pyc即使解包出来也没办法直接逆（？，和上面主函数第一行修改一致即可成功逆向

![image-20221214222400577](https://picture-1312836458.cos.ap-beijing.myqcloud.com/img/image-20221214222400577.png)

![image-20221214222425476](https://picture-1312836458.cos.ap-beijing.myqcloud.com/img/image-20221214222425476.png)

以上内容大致意思就是文件头格式不对（[链接](https://blog.csdn.net/weixin_43335392/article/details/125124297)）

依照主函数的第一行修改如下：

![image-20221214222626053](https://picture-1312836458.cos.ap-beijing.myqcloud.com/img/image-20221214222626053.png)

![image-20221214222641799](https://picture-1312836458.cos.ap-beijing.myqcloud.com/img/image-20221214222641799.png)

逆完后面的步骤就比较简单了，主文件及其中引用到的库函数中均存在一个base64后的片段，解码后拼接即可。

# ez_pvz

逆向大佬都是ida梭的orz

我当时只用ce通了一关，一直想锁定阳光的基址（奈何失败qaq

做法：

第一关：搜100，种豌豆，搜0，确定阳光临时地址

第二关：开局搜150，几十个数，挨个改为0，前几个改完查看游戏就发现找到了双豌豆和樱桃炸弹的费用地址，修改为零即可

第三关：做法同第二关，找到费用地址后查看内存，可以发现动态变化的内存地址即cd的变化地址，其**后面**的一个字节也会随着前面的变化规律变化，观察一会发现会从01（满cd）递增到10（无cd），一直修改为10即可实现无cd

![image-20221214224559923](https://picture-1312836458.cos.ap-beijing.myqcloud.com/img/image-20221214224559923.png)
